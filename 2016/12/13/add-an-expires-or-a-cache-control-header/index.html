<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!-- For SEO -->
  <meta name="baidu-site-verification" content="UFDznXUqi2" />
  <meta name="google-site-verification" content="6OTH-Srp0OtcTNkRErkCMoIbSMy8aoG0RiRBifvwKuU" />

  <!-- For open search -->
  <link rel="search" type="application/opensearchdescription+xml" href="http://maxpeng.vipcloud.me/opensearch.xml" title="Blog Search" />

  
  <title>前端性能调优(3) ┃ 添加 Expires 或者 Cache-Control 头 | 谋事在人，成事在天</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="原文链接：https://developer.yahoo.com/performance/rules.html#expires

分两个方面：

对于静态组件：通过设置未来很远的Expires头来实现“永不过期”策略
对于动态组件：使用适当的Cache-Control头来帮助浏览器实现按条件请求

网页设计越来越丰富，这意味着页面中有更多的脚本（script），样式表（stylesheet），">
<meta property="og:type" content="article">
<meta property="og:title" content="前端性能调优(3) ┃ 添加 Expires 或者 Cache-Control 头">
<meta property="og:url" content="http://maxpeng.vipcloud.me/2016/12/13/add-an-expires-or-a-cache-control-header/index.html">
<meta property="og:site_name" content="谋事在人，成事在天">
<meta property="og:description" content="原文链接：https://developer.yahoo.com/performance/rules.html#expires

分两个方面：

对于静态组件：通过设置未来很远的Expires头来实现“永不过期”策略
对于动态组件：使用适当的Cache-Control头来帮助浏览器实现按条件请求

网页设计越来越丰富，这意味着页面中有更多的脚本（script），样式表（stylesheet），">
<meta property="og:image" content="http://maxpeng.vipcloud.me/imgs/expires.jpg">
<meta property="og:updated_time" content="2016-12-15T10:46:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端性能调优(3) ┃ 添加 Expires 或者 Cache-Control 头">
<meta name="twitter:description" content="原文链接：https://developer.yahoo.com/performance/rules.html#expires

分两个方面：

对于静态组件：通过设置未来很远的Expires头来实现“永不过期”策略
对于动态组件：使用适当的Cache-Control头来帮助浏览器实现按条件请求

网页设计越来越丰富，这意味着页面中有更多的脚本（script），样式表（stylesheet），">
<meta name="twitter:image" content="http://maxpeng.vipcloud.me/imgs/expires.jpg">
<meta name="twitter:creator" content="@pengisgood">
<link rel="publisher" href="pengisgood">
  
    <link rel="alternate" href="/atom.xml" title="谋事在人，成事在天" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">谋事在人，成事在天</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://maxpeng.vipcloud.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article data-post-id="ciy8c9n8r0005tx1k3qevsly1" id="post-add-an-expires-or-a-cache-control-header" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/add-an-expires-or-a-cache-control-header/" class="article-date">
  <time datetime="2016-12-13T14:58:13.000Z" itemprop="datePublished">Dec 13 2016</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>►<a class="article-category-link" href="/categories/Web/Performance/">Performance</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      前端性能调优(3) ┃ 添加 Expires 或者 Cache-Control 头
    </h1>
  

        <div class="views">0</div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/imgs/expires.jpg" width="100%"></p>
<blockquote>
<p><em>原文链接：<a href="https://developer.yahoo.com/performance/rules.html#expires" target="_blank" rel="external">https://developer.yahoo.com/performance/rules.html#expires</a></em></p>
</blockquote>
<p>分两个方面：</p>
<ul>
<li>对于静态组件：通过设置未来很远的<code>Expires</code>头来实现“永不过期”策略</li>
<li>对于动态组件：使用适当的<code>Cache-Control</code>头来帮助浏览器实现按条件请求</li>
</ul>
<p>网页设计越来越丰富，这意味着页面中有更多的脚本（script），样式表（stylesheet），图像（image）和Flash。你的网页的首次访问者可能必须发出几个HTTP请求，但通过使用<code>Expires</code>头，你可以使这些组件成为可缓存的。这样可避免后续网页浏览中出现不必要的HTTP请求。<code>Expires</code>头最常用于图片，但它们应该用于所有组件，包括脚本，样式表和Flash组件。</p>
<a id="more"></a>
<p>浏览器（和代理）使用缓存减少HTTP请求的数量和大小，使网页加载更快。Web服务器使用HTTP响应中的<code>Expires</code>头来告诉客户端该组件可以缓存多长时间。这是一个未来的<code>Expires</code>头，它告诉浏览器，一直到2010年4月15日（译者注：原文完成早于这个时间）这个响应都不会过期。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expires: Thu, 15 Apr 2010 20:00:00 GMT</span><br></pre></td></tr></table></figure>
<p>如果你的服务器是Apache，使用<code>ExpiresDefault</code>指令设置相对于当前日期的过期时间。 下面这个例子使用<code>ExpiresDefault</code>指令将<code>Expires</code>日期设置为从请求时起10年。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">      ExpiresDefault &quot;access plus 10 years&quot;</span><br></pre></td></tr></table></figure>
<p>请记住，如果你使用将来很远的日期作为<code>Expires</code>头，你必须在组件更改时更改组件的文件名。在Yahoo!，我们通常将此步骤作为构建过程的一部分：会把版本号作为组件的文件名的一部分，例如，yahoo_2.0.6.js。</p>
<p>使用将来的时间作为<code>Expires</code>头只会影响用户首次访问你的网站后，后续的网页浏览。当用户首次访问你的网站并且浏览器的缓存为空时，它对HTTP请求的数量没有影响。因此，该性能提升的效果取决于用户访问到你网页预处理缓存的频率。（“预处理缓存”已经包含页面中的所有组件。）在Yahoo!，我们<a href="http://yuiblog.com/blog/2007/01/04/performance-research-part-2/" target="_blank" rel="external">测量</a>这一点时发现带有缓存的页面查看次数为75-85％。通过使用未来的Expires头，您可以增加浏览器缓存的组件数量，并在后续页面视图上重用，而无需通过用户的网络连接发送一个字节。</p>
<h2 id="原文"><a href="#原文" class="headerlink" title="原文"></a>原文</h2><blockquote>
<h3 id="Add-an-Expires-or-a-Cache-Control-Header"><a href="#Add-an-Expires-or-a-Cache-Control-Header" class="headerlink" title="Add an Expires or a Cache-Control Header"></a>Add an Expires or a Cache-Control Header</h3><p>tag: server</p>
<p>There are two aspects to this rule:</p>
<p>For static components: implement “Never expire” policy by setting far future <code>Expires</code> header<br>For dynamic components: use an appropriate <code>Cache-Control</code> header to help the browser with conditional requests</p>
<p>Web page designs are getting richer and richer, which means more scripts, stylesheets, images, and Flash in the page. A first-time visitor to your page may have to make several HTTP requests, but by using the Expires header you make those components cacheable. This avoids unnecessary HTTP requests on subsequent page views. Expires headers are most often used with images, but they should be used on all components including scripts, stylesheets, and Flash components.</p>
<p>Browsers (and proxies) use a cache to reduce the number and size of HTTP requests, making web pages load faster. A web server uses the Expires header in the HTTP response to tell the client how long a component can be cached. This is a far future Expires header, telling the browser that this response won’t be stale until April 15, 2010.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expires: Thu, 15 Apr 2010 20:00:00 GMT</span><br></pre></td></tr></table></figure>
<blockquote>
<p>If your server is Apache, use the ExpiresDefault directive to set an expiration date relative to the current date. This example of the ExpiresDefault directive sets the Expires date 10 years out from the time of the request.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExpiresDefault &quot;access plus 10 years&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Keep in mind, if you use a far future Expires header you have to change the component’s filename whenever the component changes. At Yahoo! we often make this step part of the build process: a version number is embedded in the component’s filename, for example, yahoo_2.0.6.js.</p>
<p>Using a far future Expires header affects page views only after a user has already visited your site. It has no effect on the number of HTTP requests when a user visits your site for the first time and the browser’s cache is empty. Therefore the impact of this performance improvement depends on how often users hit your pages with a primed cache. (A “primed cache” already contains all of the components in the page.) We <a href="http://yuiblog.com/blog/2007/01/04/performance-research-part-2/" target="_blank" rel="external">measured this at Yahoo!</a> and found the number of page views with a primed cache is 75-85%. By using a far future Expires header, you increase the number of components that are cached by the browser and re-used on subsequent page views without sending a single byte over the user’s Internet connection.</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://maxpeng.vipcloud.me/2016/12/13/add-an-expires-or-a-cache-control-header/" data-id="ciy8c9n8r0005tx1k3qevsly1" class="article-share-link">分享</a>

      
        <a class="article-tip-link">打赏</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Best-Practice/">Best Practice</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/翻译/">翻译</a></li></ul>


      <div class="tip-container">
        <div id="ciy8c9n8r0005tx1k3qevsly1" class="article-tip-box">
          <div class="payment-method">
            <label for="tip-alipay" class="article-tip-select" data-method="alipay">
              <input id="tip-alipay" name="tip" type="radio" checked/>
              支付宝
            </label>
            <label for="tip-wechat" class="article-tip-select" data-method="wechat">
              <input id="tip-wechat" name="tip" type="radio"/>
              微信
            </label>
          </div>
          <img id="alipay" src="/imgs/alipay.png">
          <img id="wechat" class="hidden" src="/imgs/wechat.png">
        </div>
      </div>
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/12/15/gzip-components/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          前端性能调优(4) ┃ Gzip 压缩
        
      </div>
    </a>
  
  
    <a href="/2016/12/02/Use-a-Content-Delivery-Network/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">前端性能调优(2) ┃ 使用 CDN</div>
    </a>
  
</nav>

  
</article>


  <ul class="ds-recent-visitors"></ul>

  
    <section id="comments">
      <div class="ds-thread" data-thread-key="post-add-an-expires-or-a-cache-control-header" data-title="前端性能调优(3) ┃ 添加 Expires 或者 Cache-Control 头" data-url="http://maxpeng.vipcloud.me/2016/12/13/add-an-expires-or-a-cache-control-header/"></div>
    </section>
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:'pengisgood'};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
       || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title">About me</h3>
  <div class="widget">
    <p><strong>彭洪伟</strong></p>
    <p><a href="mailto:pengisgood@gmail.com">PengIsGood[@]gmail.com</a></p>
    <p><a href="https://www.thoughtworks.com/" style="color: black;"><strong>Thought</strong>Works</a> 一线码农。</p>
    <p>
      Angular早期使用者，<a href="http://ngnice.com/">ngnice</a>的早期贡献者之一。除了前端技术，对Java、Scala、Ruby等也均有涉猎，并且翻译了构建工具<a href="http://www.scala-sbt.org/0.13/docs/zh-cn/index.html">SBT</a>的文档。
    </p>
    <p><a href="https://item.jd.com/11845736.html"><img src="/imgs/angular-best-practice.png" alt="" style="width:100%"/></a></p>
  </div>
</div>

  
    <div align="center">
  <a href="http://www.amazingcounters.com">
    <img border="0" src="http://cc.amazingcounters.com/counter.php?i=3199418&c=9598567" alt="AmazingCounters.com">
  </a>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/01/22/put-stylesheets-at-the-top/">前端性能调优(5) ┃ 将 Stylesheets 放在顶部</a>
          </li>
        
          <li>
            <a href="/2016/12/15/gzip-components/">前端性能调优(4) ┃ Gzip 压缩</a>
          </li>
        
          <li>
            <a href="/2016/12/13/add-an-expires-or-a-cache-control-header/">前端性能调优(3) ┃ 添加 Expires 或者 Cache-Control 头</a>
          </li>
        
          <li>
            <a href="/2016/12/02/Use-a-Content-Delivery-Network/">前端性能调优(2) ┃ 使用 CDN</a>
          </li>
        
          <li>
            <a href="/2016/12/02/Minimize-HTTP-Requests/">前端性能调优(1) ┃ 尽可能减少 HTTP 请求</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">9</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/Performance/">Performance</a><span class="category-list-count">5</span></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AngularJS/">AngularJS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ansible/">Ansible</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Best-Practice/">Best Practice</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SCSS/">SCSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sass/">Sass</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Skype/">Skype</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vagrant/">Vagrant</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/翻译/">翻译</a><span class="tag-list-count">7</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>


  
</aside>

        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 <a href="http://stackoverflow.com/story/maxpeng" target="_blank">彭洪伟（Max Peng）</a><br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    <script src="//code.jquery.com/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor:pointer;z-index:1;">
  <a title="返回顶部"><img src="/imgs/back-to-top.png" style="width:32px;height:32px;"/></a>
</div>

<script src="/js/backToTop.js"></script>

<!--Lean Cloud-->
<!-- lean cloud js -->
<!--refer to: https://leancloud.cn/docs/leanstorage_guide-js.html#更新计数器 -->
<script src="https://cdn1.lncld.net/static/js/av-min-1.2.1.js"></script>
<script>
  $(document).ready(function () {
    // 应用 ID，用来识别应用
    var APP_ID = 'P73z6DPIAfc1Jrptt0PnMore-gzGzoHsz';

    // 应用 Key，用来校验权限（Web 端可以配置安全域名来保护数据安全）
    var APP_KEY = '4n4rEhNfzn6RYUbRcpgCus7h';

    // 初始化
    AV.init({appId: APP_ID, appKey: APP_KEY});

    
    var query = new AV.Query('PageView');
    var postId = $('article').data('postId');
    var postSlug = $('article').attr('id');

    query.equalTo('postSlug', postSlug);
    query.first().then(function (pageView) {
      if (pageView) {
        increasePageView(pageView);
      } else {
        var PageView = AV.Object.extend('PageView');
        var pageView = new PageView();
        pageView.save({
          postId: postId,
          postSlug: postSlug,
          views: 0
        }).then(function (pageView) {
          increasePageView(pageView);
        })
      }
    }, function (error) {
    });

    function increasePageView(pageView) {
      pageView.increment('views', 1);
      pageView.fetchWhenSave(true);
      pageView.save().then(function (pageView) {
        updatePageView(pageView)
      });
    }
    

    function updatePageView(pageView) {
      var id = pageView.get('postSlug');
      $('#' + id + ' .views').html(pageView.get('views'));
    }
  })
</script>


  </div>
  
<!--CNZZ-->
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
  document.write(unescape("%3Cspan id='cnzz_stat_icon_1257186032'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1257186032' type='text/javascript'%3E%3C/script%3E"));</script>


</body>
</html>
